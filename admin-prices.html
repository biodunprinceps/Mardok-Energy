<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Price Admin - Mart Dok Petroleum</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#efb105',
            secondary: '#000000',
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-100 min-h-screen p-8">

  <!-- Login Screen -->
  <div id="loginScreen" class="max-w-md mx-auto">
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="text-center mb-8">
        <div class="bg-primary w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
        <h1 class="text-3xl font-bold mb-2">Admin Access</h1>
        <p class="text-gray-600">Enter your credentials to manage prices</p>
      </div>

      <form id="loginForm" class="space-y-6">
        <div>
          <label for="email" class="block text-sm font-semibold mb-2">Email Address</label>
          <input type="email" id="email" required
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
            placeholder="admin@martdokpetroleum.com">
        </div>

        <div>
          <label for="password" class="block text-sm font-semibold mb-2">Password</label>
          <input type="password" id="password" required
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
            placeholder="Enter your password">
        </div>

        <div id="loginError" class="hidden bg-red-100 border-2 border-red-500 rounded-lg p-3 text-red-700 text-sm">
          <strong>Access Denied:</strong> Invalid credentials or unauthorized IP address.
        </div>

        <button type="submit"
          class="w-full bg-primary text-black px-8 py-4 rounded-full font-bold text-lg hover:bg-yellow-500 transition">
          üîì Login to Admin Panel
        </button>
      </form>

      <div class="mt-6 p-4 bg-gray-100 rounded-lg text-sm text-gray-600">
        <div class="flex items-start">
          <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
              clip-rule="evenodd" />
          </svg>
          <div>
            <strong>Security Notice:</strong> Only authorized administrators with registered email addresses can access
            this panel.
            Your IP address: <span id="userIP" class="font-mono">Loading...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Panel (Hidden until login) -->
  <div id="adminPanel" class="max-w-4xl mx-auto hidden">
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-3xl font-bold mb-2">Diesel Price Manager</h1>
          <p class="text-gray-600">Update daily diesel prices</p>
          <p class="text-sm text-gray-500 mt-1">Logged in as: <span id="loggedInEmail" class="font-semibold"></span></p>
        </div>
        <div class="flex items-center gap-3">
          <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full font-semibold text-sm">
            ‚úì Authenticated
          </div>
          <button onclick="logout()"
            class="bg-red-500 text-white px-4 py-2 rounded-full font-semibold text-sm hover:bg-red-600">
            Logout
          </button>
        </div>
      </div>

      <form id="priceForm" class="space-y-6">
        <!-- Small Business -->
        <div class="border-2 border-gray-200 rounded-xl p-6">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <span class="bg-primary text-black w-10 h-10 rounded-full flex items-center justify-center mr-3">1</span>
            Small Business
          </h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-2">Price per Litre (‚Ç¶)</label>
              <input type="number" id="price-small" value="850"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none text-lg font-semibold">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Volume Range</label>
              <input type="text" value="500 - 2,000 litres" disabled
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600">
            </div>
          </div>
        </div>

        <!-- Commercial -->
        <div class="border-2 border-primary rounded-xl p-6 bg-primary bg-opacity-5">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <span class="bg-primary text-black w-10 h-10 rounded-full flex items-center justify-center mr-3">2</span>
            Commercial (Most Popular)
          </h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-2">Price per Litre (‚Ç¶)</label>
              <input type="number" id="price-commercial" value="820"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none text-lg font-semibold">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Volume Range</label>
              <input type="text" value="2,000 - 10,000 litres" disabled
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600">
            </div>
          </div>
        </div>

        <!-- Industrial -->
        <div class="border-2 border-gray-200 rounded-xl p-6">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <span class="bg-primary text-black w-10 h-10 rounded-full flex items-center justify-center mr-3">3</span>
            Industrial
          </h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-2">Price per Litre (‚Ç¶)</label>
              <input type="number" id="price-industrial" value="790"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none text-lg font-semibold">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Volume Range</label>
              <input type="text" value="10,000+ litres" disabled
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600">
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 pt-6 border-t-2">
          <button type="submit"
            class="flex-1 bg-primary text-black px-8 py-4 rounded-full font-bold text-lg hover:bg-yellow-500 transition transform hover:scale-105">
            üíæ Update Prices
          </button>
          <button type="button" onclick="generateCode()"
            class="flex-1 bg-black text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-gray-800 transition">
            üìã Generate Code
          </button>
        </div>
      </form>

      <!-- Generated Code Display -->
      <div id="codeOutput" class="hidden mt-8 p-6 bg-gray-900 rounded-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-white font-bold text-lg">üìù Updated Code (Copy & Paste into index.html)</h3>
          <button onclick="copyCode()"
            class="bg-primary text-black px-4 py-2 rounded-lg font-semibold hover:bg-yellow-500">
            Copy Code
          </button>
        </div>
        <pre id="generatedCode" class="text-green-400 text-sm overflow-x-auto"></pre>
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="hidden mt-6 bg-green-100 border-2 border-green-500 rounded-xl p-4">
        <div class="flex items-center text-green-800">
          <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd" />
          </svg>
          <span class="font-semibold">Prices generated successfully! Copy the code and paste it into your index.html
            file.</span>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mt-6">
      <h2 class="text-2xl font-bold mb-4">üìñ How to Update Prices</h2>
      <ol class="space-y-3 text-gray-700">
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">1</span>
          <span><strong>Enter new prices</strong> in the input fields above</span>
        </li>
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">2</span>
          <span><strong>Click "Generate Code"</strong> to create the updated JavaScript</span>
        </li>
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">3</span>
          <span><strong>Copy the generated code</strong> from the box below</span>
        </li>
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">4</span>
          <span><strong>Open index.html</strong> and find the "DYNAMIC PRICING SYSTEM" section (around line 1040)</span>
        </li>
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">5</span>
          <span><strong>Replace the dieselPrices object</strong> with the new values</span>
        </li>
        <li class="flex items-start">
          <span
            class="bg-primary text-black w-6 h-6 rounded-full flex items-center justify-center mr-3 mt-1 flex-shrink-0 text-sm font-bold">6</span>
          <span><strong>Save and refresh</strong> your website to see the updated prices!</span>
        </li>
      </ol>
    </div>
  </div>

  <script>
    // ==========================================
    // SECURITY CONFIGURATION - UPDATE THESE!
    // ==========================================

    const AUTHORIZED_USERS = [{
        email: 'admin@admin.com',
        password: '12345678!' // C HANGE THIS PASSWORD!
      },
      {
        email: 'manager@martdokpetroleum.com',
        password: 'Manager2025!' // CHANGE THIS PASSWORD!
      }
      // Add more authorized users here
    ];

    // Optional: Whitelist specific IP addresses (leave empty to allow all IPs)
    const WHITELISTED_IPS = [
      // '192.168.1.100', // Example: Your office IP
      // '41.58.123.45'   // Example: Your home IP
      // Leave empty to allow any IP (email/password only)
    ];

    // ==========================================
    // AUTHENTICATION SYSTEM
    // ==========================================

    let userIP = 'Unknown';
    let isAuthenticated = false;

    // Get user's IP address
    fetch('https://api.ipify.org?format=json')
      .then(response => response.json())
      .then(data => {
        userIP = data.ip;
        document.getElementById('userIP').textContent = userIP;
        checkIPWhitelist();
      })
      .catch(() => {
        document.getElementById('userIP').textContent = 'Unable to detect';
      });

    function checkIPWhitelist() {
      // If whitelist is empty, skip IP check
      if (WHITELISTED_IPS.length === 0) return;

      // Check if current IP is whitelisted
      if (!WHITELISTED_IPS.includes(userIP)) {
        document.getElementById('loginError').textContent =
          `Access restricted. Your IP address (${userIP}) is not authorized.`;
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    // Login form handler
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.toLowerCase().trim();
      const password = document.getElementById('password').value;

      // Check IP whitelist first (if configured)
      if (WHITELISTED_IPS.length > 0 && !WHITELISTED_IPS.includes(userIP)) {
        showError(`Your IP address (${userIP}) is not authorized to access this panel.`);
        return;
      }

      // Check credentials
      const user = AUTHORIZED_USERS.find(u =>
        u.email.toLowerCase() === email && u.password === password
      );

      if (user) {
        // Successful login
        isAuthenticated = true;
        sessionStorage.setItem('adminAuth', 'true');
        sessionStorage.setItem('adminEmail', email);
        showAdminPanel(email);
      } else {
        showError('Invalid email or password. Please try again.');
      }
    });

    function showError(message) {
      const errorDiv = document.getElementById('loginError');
      errorDiv.innerHTML = `<strong>Access Denied:</strong> ${message}`;
      errorDiv.classList.remove('hidden');

      // Shake animation
      errorDiv.style.animation = 'shake 0.5s';
      setTimeout(() => errorDiv.style.animation = '', 500);
    }

    function showAdminPanel(email) {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
      document.getElementById('loggedInEmail').textContent = email;

      // Load saved prices
      loadPrices();
    }

    function logout() {
      sessionStorage.removeItem('adminAuth');
      sessionStorage.removeItem('adminEmail');
      isAuthenticated = false;
      location.reload();
    }

    // Check if already logged in
    window.addEventListener('load', () => {
      const isLoggedIn = sessionStorage.getItem('adminAuth');
      const email = sessionStorage.getItem('adminEmail');

      if (isLoggedIn && email) {
        showAdminPanel(email);
      }
    });

    // ==========================================
    // PRICE MANAGEMENT (Original Code)
    // ==========================================

    const form = document.getElementById('priceForm');
    const codeOutput = document.getElementById('codeOutput');
    const generatedCode = document.getElementById('generatedCode');
    const successMessage = document.getElementById('successMessage');

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      if (!isAuthenticated) {
        alert('Please login first');
        return;
      }

      generateCode();
    });

    function generateCode() {
      const smallPrice = document.getElementById('price-small').value;
      const commercialPrice = document.getElementById('price-commercial').value;
      const industrialPrice = document.getElementById('price-industrial').value;

      const code = `const dieselPrices = {
  small: ${smallPrice},      // Small Business (500-2,000 litres)
  commercial: ${commercialPrice}, // Commercial (2,000-10,000 litres)
  industrial: ${industrialPrice}  // Industrial (10,000+ litres)
};`;

      generatedCode.textContent = code;
      codeOutput.classList.remove('hidden');
      successMessage.classList.remove('hidden');

      // Save to localStorage
      savePrices();

      // Scroll to code
      codeOutput.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }

    function copyCode() {
      const code = generatedCode.textContent;
      navigator.clipboard.writeText(code).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úì Copied!';
        btn.classList.add('bg-green-500');

        setTimeout(() => {
          btn.textContent = originalText;
          btn.classList.remove('bg-green-500');
        }, 2000);
      });
    }

    function loadPrices() {
      const savedPrices = localStorage.getItem('dieselPrices');
      if (savedPrices) {
        const prices = JSON.parse(savedPrices);
        document.getElementById('price-small').value = prices.small;
        document.getElementById('price-commercial').value = prices.commercial;
        document.getElementById('price-industrial').value = prices.industrial;
      }
    }

    function savePrices() {
      const prices = {
        small: document.getElementById('price-small').value,
        commercial: document.getElementById('price-commercial').value,
        industrial: document.getElementById('price-industrial').value
      };
      localStorage.setItem('dieselPrices', JSON.stringify(prices));
    }

    // Save prices when changed
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('change', savePrices);
    });

    // Add shake animation
    const style = document.createElement('style');
    style.textContent = `
@keyframesshake{
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>

</html>